\section{Method}

\subsection{Problem Formulation}
At each control step $t$, a frozen policy emits hidden state $\mathbf{h}_t \in \mathbb{R}^m$ and action $\mathbf{a}_t \in \mathbb{R}^d$. We learn a safety head:
\begin{equation}
f_\theta(\mathbf{h}_t) = \{\hat{y}^{\mathrm{fail}}_t,\hat{\tau}_t,\widehat{\Delta\mathbf{p}}_t\},
\end{equation}
where $\hat{y}^{\mathrm{fail}}_t$ is failure logit, $\hat{\tau}_t$ is time-to-failure, and $\widehat{\Delta\mathbf{p}}_t=(\Delta x,\Delta y,\Delta z)$ is Cartesian correction.

\subsection{Architecture (v4)}
\begin{itemize}[leftmargin=1.2em]
    \item Input LayerNorm on hidden state.
    \item Shared encoder with hidden width 256, GELU, dropout 0.3.
    \item Three heads: fail, ttf, correction.
\end{itemize}

\subsection{Training Objective}
\begin{align}
\mathcal{L}_{\mathrm{fail}} &= \mathrm{BCEWithLogits}(\hat{y}^{\mathrm{fail}}, y; w^+_{\mathrm{batch}}), \\
\mathcal{L}_{\tau} &= \mathrm{Huber}_{\delta}(\hat{\tau},\tau), \quad \delta=0.1, \\
\mathcal{L}_{\Delta p} &= \mathrm{Huber}_{\delta}(\widehat{\Delta\mathbf{p}},\Delta\mathbf{p}), \\
\mathcal{L} &= \lambda_f\mathcal{L}_{\mathrm{fail}} + \lambda_\tau\mathcal{L}_{\tau} + \lambda_c\mathcal{L}_{\Delta p}.
\end{align}
Optimizer: AdamW with weight decay $10^{-3}$.

\subsection{Inference-Time Steering}
\begin{align}
\tilde{\Delta\mathbf{p}}_t &= \beta\tilde{\Delta\mathbf{p}}_{t-1} + (1-\beta)\widehat{\Delta\mathbf{p}}_t,\\
\bar{\Delta\mathbf{p}}_t &= \mathrm{ClampNorm}(\tilde{\Delta\mathbf{p}}_t, c_{\max}),\\
\mathbb{I}_t &= \mathbb{1}[\|\bar{\Delta\mathbf{p}}_t\|>\tau_c] \cdot \mathbb{1}[\sigma(\hat{y}^{\mathrm{fail}}_t)\ge \tau_f],\\
\mathbf{a}^{xyz}_t &\leftarrow \mathbf{a}^{xyz}_t + \alpha\,\mathbb{I}_t\,\bar{\Delta\mathbf{p}}_t/s_a.
\end{align}

\subsection{Failure-Detection-Only Baseline (Latent Stop)}
To isolate detection from recovery, we define a stop-only baseline:
\begin{equation}
\mathbf{a}_t \leftarrow \mathbf{0} \quad \text{if} \quad \sigma(\hat{y}^{\mathrm{fail}}_t) \ge \tau_{\mathrm{stop}}.
\end{equation}
This directly tests whether detection alone preserves success.

\subsection{OOD Protocols}
We include two OOD mechanisms:
\begin{itemize}[leftmargin=1.2em]
    \item \textbf{Disturbance OOD:} sudden exogenous action-space push mid-episode.
    \item \textbf{Environment OOD:} custom per-task BDDL overrides (novel obstacle/layout) via task-to-BDDL mapping.
\end{itemize}

\subsection{Implementation Status Placeholders}
TODO: final hyperparameter table], TODO: final per-model feature dimensions], TODO: final compute budget accounting].
